<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æŒ‡ç¤ºæ›¸</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <aside class="sidebar">
      <button id="item-0" class="menu-item" onclick="selectMenu(this,'top.html'); localStorage.clear(); location.reload();" title="æŒ‡ç¤ºæ›¸ãƒˆãƒƒãƒ—">æŒ‡ç¤ºæ›¸ãƒˆãƒƒãƒ—</button>
      <ul class="accordion">
        <!-- [Start] Whale -->
        <li>
          <input type="checkbox" id="menu-0">
          <label for="menu-0" title="Whale"><span class="arrow">â–¶</span><span class="menu-label">ğŸ“ Whale</span></label>
          <ul class="submenu">
            <!-- [Start] Mode -->
            <li>
              <input type="checkbox" id="menu-1">
              <label for="menu-1" title="Mode"><span class="arrow">â–¶</span><span class="menu-label">ğŸ“ Mode</span></label>
              <ul class="submenu">
                <!-- [Start] Common -->
                <li>
                  <input type="checkbox" id="menu-2">
                  <label for="menu-2" title="Common"><span class="arrow">â–¶</span><span class="menu-label">ğŸ“ Common</span></label>
                  <ul class="submenu">
                    <!-- [Start] Widget -->
                    <li>
                      <input type="checkbox" id="menu-3">
                      <label for="menu-3" title="Widget"><span class="arrow">â–¶</span><span class="menu-label">ğŸ“ Widget</span></label>
                      <ul class="submenu">
                        <!-- [Start] Character -->
                        <li>
                          <input type="checkbox" id="menu-4">
                          <label for="menu-4" title="Character"><span class="arrow">â–¶</span><span class="menu-label">ğŸ“ Character</span></label>
                          <ul class="submenu">
                            <!-- [Start] Global -->
                            <li>
                              <input type="checkbox" id="menu-5">
                              <label for="menu-5" title="Global"><span class="arrow">â–¶</span><span class="menu-label">ğŸ“ Global</span></label>
                              <ul class="submenu">
                                <li>
                                  <button id="item-1" class="menu-item" onclick="selectMenu(this,'/Whale/Mode/Common/Widget/Character/Global/WBP_Character_Main_Global.html')" title="WBP_Character_Main_Global">ğŸ“„ WBP_Character_Main_Global</button>
                                </li>
                              </ul>
                            </li>
                            <!-- [End] Global -->
                            <!-- [Start] Parts -->
                            <li>
                              <input type="checkbox" id="menu-6">
                              <label for="menu-6" title="Parts"><span class="arrow">â–¶</span><span class="menu-label">ğŸ“ Parts</span></label>
                              <ul class="submenu">
                                <!-- [Start] CharacterThumbnail -->
                                <li>
                                  <input type="checkbox" id="menu-7">
                                  <label for="menu-7" title="CharacterThumbnail"><span class="arrow">â–¶</span><span class="menu-label">ğŸ“ CharacterThumbnail</span></label>
                                  <ul class="submenu">
                                    <li>
                                      <button id="item-1" class="menu-item" onclick="selectMenu(this,'/Whale/Mode/Common/Widget/Character/Parts/CharacterThumbnail/WBP_Character_Thumbnail.html')" title="WBP_Character_Thumbnail">ğŸ“„ WBP_Character_Thumbnail</button>
                                    </li>
                                  </ul>
                                </li>
                                <!-- [End] CharacterThumbnail -->
                              </ul>
                            </li>
                            <!-- [End] Parts -->
                          </ul>
                        </li>
                        <!-- [End] Character -->
                      </ul>
                    </li>
                    <!-- [End] Widget -->
                  </ul>
                </li>
                <!-- [End] Common -->
              </ul>
            </li>
            <!-- [End] Mode -->
          </ul>
        </li>
        <!-- [End] Whale -->
      </ul>
    </aside>
    <!-- ãƒªã‚µã‚¤ã‚ºç”¨ãƒãƒ³ãƒ‰ãƒ« -->
    <div class="resizer"></div>
    <!-- ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºé ˜åŸŸ -->
    <main class="main-content">
      <iframe id="viewer" src="top.html"></iframe>
    </main>
  </div>
  <!-- JavaScript -->
  <script>
    const viewer = document.getElementById('viewer');
    const sidebar = document.querySelector('.sidebar');
    const resizer = document.querySelector('.resizer');
    
    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠæ™‚ã®å‡¦ç†
    function selectMenu(el, file) {
      // iframeã«èª­ã¿è¾¼ã¿
      viewer.src = file;
      
      // é¸æŠçŠ¶æ…‹ã‚’ä¿å­˜
      localStorage.setItem('activeMenuId', el.id);
      localStorage.setItem('activeContentUrl', file);
      
      // ãƒãƒƒã‚·ãƒ¥æ›´æ–°
      location.hash = file.replace(/\.html$/, '');
    }
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å¾©å…ƒ
    window.addEventListener('DOMContentLoaded', () => {
      const savedId = localStorage.getItem('activeMenuId');
      const savedUrl = localStorage.getItem('activeContentUrl');
      
      if (savedId && savedUrl) {
        const target = document.getElementById(savedId);
        if (target) {
          // ãƒšãƒ¼ã‚¸å¾©å…ƒ
          viewer.src = savedUrl;
        }
      }
      
      const currentPage = document.getElementById('viewer').getAttribute('src');
      if (!currentPage) return;
      
      // å¯¾å¿œã™ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æ¢ã™
      const target = [...document.querySelectorAll('.menu-item')]
        .find(btn => btn.getAttribute('onclick')?.includes(currentPage));
      
      // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯è¦ªéšå±¤ã‚’ãŸã©ã£ã¦é–‹ã
      let parent = target.closest('li');
      while (parent) {
        const cb = parent.querySelector('input[type="checkbox"]');
        if (cb) {
          cb.checked = true;
          parent.parentElement.querySelectorAll(':scope > li > input[type="checkbox"]').forEach(sibling => {
            if (sibling !== cb) sibling.checked = false;
          });
        }
        parent = parent.parentElement.closest('li');
      }
    });
    
    // iframe å†…ã‹ã‚‰å‘¼ã°ã‚Œã‚‹é–¢æ•°
    function navigateFromIframe(file) {
      viewer.src = file;
      location.hash = file.replace(/\.html$/, '');
      
      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
      const target = [...document.querySelectorAll('.menu-item')]
        .find(btn => btn.getAttribute('onclick')?.includes(file));
      if (target) {
        localStorage.setItem('activeMenuId', target.id);
        localStorage.setItem('activeContentUrl', file);
      }
    }
    
    // ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒªã‚µã‚¤ã‚ºå‡¦ç†
    let isResizing = false;
    let startX = 0;
    let startWidth = 0;
    
    resizer.addEventListener('mousedown', (e) => {
      isResizing = true;
      startX = e.clientX;
      startWidth = sidebar.offsetWidth;
      document.body.style.cursor = 'ew-resize';
      viewer.classList.add('disable-events');
      e.preventDefault();
    });
    
    document.addEventListener('mousemove', (e) => {
      if (!isResizing) return;
      const dx = e.clientX - startX;
      const newWidth = startWidth + dx;
      if (newWidth > 100 && newWidth < 800) {
        sidebar.style.width = newWidth + 'px';
      }
    });

    document.addEventListener('mouseup', () => {
      if (isResizing) {
        isResizing = false;
        document.body.style.cursor = 'default';
        viewer.classList.remove('disable-events');
      }
    });
    
    // ãƒãƒƒã‚·ãƒ¥å¤‰åŒ–æ™‚ã«å¾©å…ƒå‡¦ç†
    window.addEventListener('hashchange', () => {
      const hash = location.hash.replace(/^#/, '') + '.html';
      if (!hash) return;
        // iframe ã«åæ˜ 
        viewer.src = hash;
        
        // å¯¾å¿œã™ã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æ¢ã™
        const target = [...document.querySelectorAll('.menu-item')]
          .find(btn => btn.getAttribute('onclick')?.includes(hash));
        
        if (target) {
          // localStorage æ›´æ–°
          localStorage.setItem('activeMenuId', target.id);
          localStorage.setItem('activeContentUrl', hash);
          
          // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å±•é–‹
          let parent = target.closest('li');
          while (parent) {
            const cb = parent.querySelector('input[type="checkbox"]');
            if (cb) cb.checked = true;
              parent = parent.parentElement.closest('li');
          }
        }
    });
  </script>
</body>
</html>